```{r}
library(tidyverse)
library(skimr)
library(survival)
library(survminer)
library(fitdistrplus)

root = 'C://Users//corma//Documents//GitHub//WW2_Analysis//u-boat_analysis.rmd'
```
```{r}
uboats = read_csv("uboats_cleaned.csv")
skim(uboats)
```
```{r}
# drop rows with NA Active_Service and Lifespan
uboats = uboats %>%
  drop_na(Active_Service, Lifespan)
skim(uboats)
```
```{r}
colnames(uboats)
```
[1] "Name"
[2] "Year"
[3] "Type"
[4] "Notable Commanders"
[5] "Warships_sunk_n_total_loss_No"
[6] "Warships_sunk_n_total_loss_Tons-n-GRT"
[7] "Warships_Damaged_No"
[8] "Warships_Damaged_Tons-n-GRT"
[9] "Merchant_Ships_sunk_No"
[10] "Merchant_Ships_sunk_GRT"
[11] "Merchant_Ships_damaged_No"
[12] "Merchant_Ships_damaged_GRT"
[13] "Merchant_Ships_total_loss_No"
[14] "Merchant_Ships_total_loss_GRT"
[15] "Fate_Event"
[16] "Fate_Date"
[17] "Notes"
[18] "URL"
[19] "Commissioned"
[20] "Lifespan"
[21] "Active_Service"

```{r}
# select Name, Type, Fate_Event, Notes, Lifespan, and Active_Service for Survival analysis
uboats_SA = uboats %>%
  dplyr::select(Name, Type, Fate_Event, Notes, Lifespan, Active_Service, 'Notable Commanders')
```
```{r}
# show the unique fates, graph by count
fate_counts = uboats_SA %>%
  count(Fate_Event) %>%
  arrange(desc(n))

fate_counts %>% ggplot() +
  geom_col(aes(x = reorder(Fate_Event, n), y = n)) +
  coord_flip() +
  labs(title = "Unique Fates of U-Boats", x = "Count", y = "Fate") +
  theme_minimal()
```
```{r}
# if Sunk, Scuttled, or Surrendered, then 1, else 0
uboats_SA['Status'] = ifelse(grepl("Sunk|Scuttled|Surrendered", uboats_SA$Fate_Event), 1, 0)
```

```{r}
# create a km curve
km_fit = survfit(Surv(Active_Service, Status) ~ 1, data = uboats_SA)
summary(km_fit)
```
```{r}
# drop /n from Type
uboats_SA$Type = gsub("\n", "", uboats_SA$Type)
unique_types = unique(uboats_SA["Type"])
unique_types
```
```{r}
# graph unique types by count
type_counts = uboats_SA %>%
  count(Type) %>%
  arrange(desc(n))

type_counts %>% ggplot() +
  geom_col(aes(x = reorder(Type, n), y = n)) +
  coord_flip() +
  labs(title = "Unique Types of U-Boats", x = "Count", y = "Type") +
  theme_minimal()
```
```{r}
# type_viic = uboats_SA %>%
#   filter(Type == "VIIC")
# viic_fit = survfit(Surv(Active_Service, Status) ~ 1, data = type_viic)
# ggsurvplot(viic_fit, data = type_viic, palette = "YlOrRd", risk.table = F, conf.int = T) +
#   labs(title = "Survival of VIIC U-Boats", x = "Active Service (Years)")

type_km = function(utype, table) {
  type_table = table %>% filter(Type == utype)
  type_fit =  survfit(Surv(Active_Service, Status) ~ 1, data = type_table)
  ggsurvplot(type_fit, data = type_table, palette = "YlOrRd", risk.table = F, conf.int = T) +
          labs(title = "Survival of VIIC U-Boats", x = "Active Service (Years)")
}
```
## notable commanders analysis
```{r}
#uniq comanders, split by ,

```